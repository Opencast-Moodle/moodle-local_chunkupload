define ("local_chunkupload/chunkupload",["exports","jquery","core/str","core/notification"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=f;b=e(b);d=e(d);function e(a){return a&&a.__esModule?a:{default:a}}function f(a,e,f,g,h,i){var o,p,q,r,s,t,u,v;q=(0,b.default)("#"+a+"_file");v=(0,b.default)("#"+a).val();var w=q.next();r=w.find(".chunkupload-filename");s=w.find(".chunkupload-progress");t=w.find(".chunkupload-icon");u=w.next();o=g;p=h;q.change(function(){l();var a=q.get(0).files[0],b=".";if(-1!==a.name.indexOf(".")){var c=a.name.split(".");b="."+c[c.length-1]}if(!("*"===e||e instanceof Array&&-1!==e.indexOf(b)||1!==e.indexOf("*"))){q.val(null);n({key:"invalidfiletype",component:"core_repository",param:b});return}else if(-1!==f&&a.size>f){q.val(null);n({key:"errorpostmaxsize",component:"core_repository"});return}r.text(a.name);j(a)});u.on("click",function(a){l();var c={id:v},d=new XMLHttpRequest;d.open("post",o+"/local/chunkupload/deleteupload_ajax.php?"+b.default.param(c));d.send(null);r.text(i);q.val(null);a.stopPropagation()});function j(a){var c=p<a.size?p:a.size,d={start:0,end:c,length:a.size,filename:a.name,id:v},e=a.slice(0,c),f=new XMLHttpRequest;f.open("post",o+"/local/chunkupload/startupload_ajax.php?"+b.default.param(d));f.upload.onprogress=function(b){m(b.loaded,a.size)};f.onreadystatechange=function(){if(4===f.readyState){if(200===f.status){var b=JSON.parse(f.responseText);if(b.error!==void 0){n(b.error)}else{if(c<a.size){k(a,p)}}}}};f.setRequestHeader("Content-Type","application/octet-stream");f.send(e)}function k(a,c){var e=c+p<a.size?c+p:a.size,f={start:c,end:e,id:v},g=a.slice(c,e),h=new XMLHttpRequest;h.open("post",o+"/local/chunkupload/proceedupload_ajax.php?"+b.default.param(f));h.upload.onprogress=function(b){m(b.loaded+c,a.size)};h.onreadystatechange=function(){if(4===h.readyState){if(200===h.status){var b=JSON.parse(h.responseText);if(b.error!==void 0){n(b.error)}else{if(e<a.size){k(a,e)}}}}};h.onerror=function(){l();d.default.alert("Error","Failure while uploading!","Ok")};h.setRequestHeader("Content-Type","application/octet-stream");h.send(g)}function l(){m(0,1);r.text("")}function m(a,b){if(a===b){s.css("width","0")}else{s.css("width",100*a/b+"%")}t.prop("hidden",a!==b);u.prop("hidden",a!==b)}function n(a){l();if("string"==typeof a){(0,c.get_strings)([{key:"error"},{key:"ok"}]).done(function(b){d.default.alert(b[0],a,b[1])}).fail(d.default.exception)}else{(0,c.get_strings)([{key:"error"},a,{key:"ok"}]).done(function(a){d.default.alert(a[0],a[1],a[2])}).fail(d.default.exception)}}}});
//# sourceMappingURL=chunkupload.min.js.map
